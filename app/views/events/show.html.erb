<%# cloudinary for images %>
<div class="event-banner" style="background-image: linear-gradient(rgba(0,0,0,0.4), rgba(0,0,0,0.3))">
  <% if @event.photo.attached? %>
    <%= cl_image_tag @event.photo.key, crop: :fill %>
  <% end %>
 <% #   https://res.cloudinary.com/hafh/image/upload/v1654030136/development/9evck89d5fq6ctfoxco3ase4rvxd.jpg %>
 <% # banner   https://res.cloudinary.com/hafh/image/upload/c_fill,g_auto,h_250,w_970/b_rgb:000000,e_gradient_fade,y_-0.50/c_scale,co_rgb:ffffff,fl_relative,l_text:montserrat_25_style_light_align_center:Shop%20Now,w_0.5,y_0.18/v1654030136/development/{#q}.jpg %>

  <% if @event.photo.attached? %>
    <%= cl_image_tag @event.photo.key, crop: :fill %>
  <% end %>
  <div class="container d-flex flex-column justify-content-center h-100">
    <h1><%= @event.title %></h1>
    <h3><%= @event.category.name %></h3>

    <%# I need two buttons, first appears when open the event to assist to the event, then Not going to cancel %>
    <% unless @event.user == current_user %>
      <% if !@my_participation %>
        <%= link_to 'Attend', event_participations_path(@event), method: 'post', class: "btn btn-primary px-4 rounded-5", style:"max-width: max-content;" %>
      <% else %>
        <h5 class="fst-italic">Attending</h5>
        <%= link_to "Cancel", participation_path(@my_participation),
        data: { confirm: "Are you sure you want to delete this event?" },
        method: "delete",
        class: "btn btn-primary px-4 rounded-5", style:"max-width: max-content;" %>
      <% end %>
    <% end %>
  </div>
</div>

<div class='container'>
<div class="row position-relative">
  <div class="event-popup-title col-sm-6 mx-2 pt-2 text-center">
  <%# starting_time ending_time  %>
    <h4><%= @event.date.strftime('%A, %m/%d/%Y') %> - <%= @event.starting_time %></h4>
  </div>
  <div class="col-sm-6 pt-5 bg-white ps-4">
    <div class="d-flex justify-content-end">
      <%= link_to 'Back to dashboard', events_path, class: "btn btn-primary me-2"%>

      <% if @event.user == current_user %>
        <%= link_to "Edit", edit_event_path(@event), class: "btn btn-primary me-2" %>
      <% end %>
      <%# needs to set the path for both buttons,
      \ Join button need to be disabled if user joined the event.
      \ Also need a pop-up to let know the user he joined the event.  %>

      <%# Jose added the button below to delete the event.
      It only appers if the user is the one who created the event%>

      <% if @event.user == current_user %>
        <%= link_to "Delete", event_path(@event),
        data: { confirm: "Are you sure you want to delete this event?" },
        method: :delete,
        class: 'btn btn-primary',
        style: "max-width: max-content;" %>
      <% end %>
    <%# INFO EVENT  %>
    </div class="info-event position-relative">
      <h4 class="pt-4">Location:</h4>
      <p><%= @event.location %></p>
      <h4>Description:</h4>
      <p><%= @event.description %></p>
      <%# PARTICIPATIONS %>
      <div class="participation-info sticky-bottom">
         <%# Need to set the box to the right-bottom %>
        <% if @participations.size > 4 %>
          <p><%= @participations.first.user.first_name %>, <%= @participations.second.user.first_name %> and <%= @participations.size - 2 %> more people are going.</p>
        <% elsif @participations.size == 3 %>
          <p><%= @participations.first.user.first_name %>, <%= @participations.second.user.first_name %> and <%= @participations.third.user.first_name %> are going.</p>
        <% elsif @participations.size == 2 %>
            <p><%= @participations.first.user.first_name %> and <%= @participations.second.user.first_name %> are going.</p>
        <% else %>
           <p>0 people are attending.</p>
        <% end %>
      </div>
  </div>

  <div class="col-sm-6 bg-white min-height: 380px">
    <div class="map-event"
      data-controller="mapbox"
      data-mapbox-markers-value="<%= @markers.to_json %>"
      data-mapbox-api-key-value="<%= ENV['MAPBOX_API_KEY'] %>">
    </div>
  </div>

</div>
</div>
